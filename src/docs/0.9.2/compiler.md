# Kipper Compiler

The Kipper Compiler is a TypeScript-based compiler that can compile Kipper code into TypeScript and generate the required overhead for the Kipper program. (In the future, native JavaScript should be supported as well. See [#32](https://github.com/Luna-Klatzer/Kipper/issues/32) for more information.)

## Kipper API

Kipper provides a TypeScript API for interacting with its compiler, which can be used to configure and inspect the compilation of a program. This API is per default shipped with the `@kipper/core` package and the `kipper-standalone.js` file.

## Configuring the Kipper Compiler

Configuring `KipperCompile.compile()` can be done using the `CompileConfig` interface, which defines all available parameters for a compilation.

### Kipper Compiler Parameters

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type<br /></th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>fileName</td>
      <td>string</td>
      <td>
        The name of the file. Per default
        <code>anonymous-script</code>.
      </td>
    </tr>
    <tr>
      <td>target</td>
      <td>KipperTarget</td>
      <td>
        The Kipper target instance, which defines the translation behaviour of the Kipper AST
        nodes. Per default <code>TypeScriptTarget</code>.
      </td>
    </tr>
    <tr>
      <td>optimisationOptions</td>
      <td>OptimisationOptions</td>
      <td>
        <p>The options for optimising the Kipper output.</p>
        <p>Defaults to an object with the following values:</p>
        <ul class="bullet-list">
          <li><code>optimiseInternals: true</code></li>
          <li><code>optimiseBuiltIns: false</code></li>
        </ul>
        <p>
          More info down below in
          <a href="#kipper-optimiser-parameters">Kipper Optimiser Parameters</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td>extendBuiltIns</td>
      <td>Array&lt;BuiltInFunction&gt;</td>
      <td>
        Additional built-in functions that should be available in the Kipper program. This
        extends builtIns and is per default empty.<br />
      </td>
    </tr>
    <tr>
      <td>builtIns<br /></td>
      <td>Array&lt;BuiltInFunction&gt;</td>
      <td>
        Standard built-in functions that should be available in the Kipper program.
        <br /><br />If this is defined with new built-in functions that Kipper does not
        implement per default, the Kipper target class will have to be updated as well to
        implement the generation of these built-ins. <br /><br />Defaults to the function as
        listed in <a href="./built-in-functions.html">Built-in Functions</a>.<br />
      </td>
    </tr>
  </tbody>
</table>

### Kipper Optimiser Parameters

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>optimiseInternals</td>
      <td>boolean</td>
      <td>
        If set to true, the internal functions (functions generated by the Kipper compiler to
        provide specific functionality) of the compiled code will be optimised using
        tree-shaking reducing the size of the output. Defaults to <code>true</code>.
      </td>
    </tr>
    <tr>
      <td>optimiseBuiltIns</td>
      <td>boolean</td>
      <td>
        If set to true, the
        <a href="./built-in-functions.html">built-in functions</a>
        of the compiled code will be optimised using tree-shaking reducing the size of the
        output. Defaults to <code>false</code>.
      </td>
    </tr>
  </tbody>
</table>

### Example Configuration

```ts
import { KipperCompiler } from "@kipper/core";
import { TypeScriptTarget } from "@kipper/core/lib/targets/typescript";

const compiler = new KipperCompiler();
const result = compiler.compile(
	kipperCode, // A string or a KipperParseStream containing the source code
	{
		fileName: "myProgram.kip",
		target: new TypeScriptTarget(),
		optimisationOptions: {
			optimiseInternals: true, // Removes any unused internal function
			optimiseBuiltIns: true, // Removes any unused built-in function
		},
	},
);
```

## Kipper CLI Parameters

Parameters for the Kipper Compiler CLI in the console.

<table>
  <thead>
    <tr>
      <th>Flags</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-b, --[no-]optimise-builtins<br /></td>
      <td>
        If set to true, the built-in functions of the compiled code will be optimised using
        tree-shaking reducing the size of the output.
      </td>
    </tr>
    <tr>
      <td>-e, --encoding=encoding</td>
      <td>
        The encoding that should be used to read the file (ascii,utf8,utf16le). Defaults to
        <code>utf8</code>.
      </td>
    </tr>
    <tr>
      <td>-i, --[no-]optimise-internals</td>
      <td>
        If set to true, the internal functions of the compiled code will be optimised using
        tree-shaking reducing the size of the output.
      </td>
    </tr>
    <tr>
      <td>-o, --output-dir=output-dir</td>
      <td>
        The build directory where the compiled files should be placed. If the path does not
        exist, it will be created. Defaults to
        <code>build</code>.<br />
      </td>
    </tr>
    <tr>
      <td>-s, --string-code=string-code<br /></td>
      <td>
        The content of a Kipper file that can be passed as a replacement for the 'file'
        parameter.<br />
      </td>
    </tr>
  </tbody>
</table>

### Example CLI Command

```bash
kipper compile -s 'call print("Hello world!");' -e utf16le -i -b
```
